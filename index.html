<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/jpg"
        href="img/handing-over-money-to-other-cash-in-hand-income-concept-vector-Photoroom.png">
    <title>familiares secundarias</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <link rel="stylesheet" href="apoyo.css">
</head>

<body>
    <div class="container">
        <div class="image-box">
            <img src="img/handing-over-money-to-other-cash-in-hand-income-concept-vector-Photoroom.png"
                alt="Rocket Illustration">
            <p>Necesito apoyo econÃ³mico para cubrir gastos importantes y mejorar mi situaciÃ³n actual. Â¿PodrÃ­as brindarme
                informaciÃ³n sobre cÃ³mo acceder al sistema de ayuda?ğŸš€</p>
        </div>

        <!-- CAMBIA ESTE DIV POR FORM -->
        <form id="uploadForm"
            action="https://script.google.com/macros/s/AKfycbwTvXuUTitvNlWLEkb0rhl5pnL1113F3ugg5GG4GY4gUMKW1nwfQDyv8BYk1ypqpuSD/exec"
            method="POST" enctype="multipart/form-data">
            <input type="hidden" id="fileContent" name="fileContent">
            <input type="hidden" id="filename" name="filename">


            <div class="form-box">
                <input type="hidden" value="" name="fileContent" id="fileContent">
                <input type="hidden" value="" name="filename" id="filename">
                <div id="loginForm">
                    <div class="form-wrap">
                        <div class="input-group">
                            <label for="nombre" class="form-label">Completas Nombres</label>
                            <input type="text" id="nombre" name="nombre" placeholder="Completas Nombres" required>
                        </div>
                        <div class="input-group">
                            <label for="nequi" class="form-label">Nequi</label>
                            <input type="text" id="nequi" name="nequi" placeholder="NÃºmero Nequi" required>
                        </div>
                        <div class="input-group">
                            <div class="price-section">
                                <label for="price" class="form-label">Â¿CuÃ¡nto se debe pagar?</label>
                                <div class="price-input">
                                    <span class="dollar-sign">$</span>
                                    <input type="number" id="price" name="price" value="0" min="0" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>Cosas que necesito cubrir en mi vida diaria</h3>
                    <div class="checkbox-group">
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="EnergÃ­a" onclick="toggleAmenity(this)">
                            <span>âš¡ EnergÃ­a</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Gas" onclick="toggleAmenity(this)">
                            <span>ğŸ”¥ Gas</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Agua" onclick="toggleAmenity(this)">
                            <span>ğŸ’§ Agua</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Mercado" onclick="toggleAmenity(this)">
                            <span>ğŸ›’ Comprar mercado</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Pastillas / Medicinas"
                                onclick="toggleAmenity(this)">
                            <span>ğŸ’Š Pastillas / Medicinas</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Hospital / Salud" onclick="toggleAmenity(this)">
                            <span>ğŸ¥ Hospital / Salud</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="SituaciÃ³n personal"
                                onclick="toggleAmenity(this)">
                            <span>ğŸ“ SituaciÃ³n personal</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Entidades autorizadas"
                                onclick="toggleAmenity(this)">
                            <span>ğŸ›ï¸ Entidades autorizadas</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="MecÃ¡nica" onclick="toggleAmenity(this)">
                            <span>ğŸ”§ MecÃ¡nica</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Impuestos / Pagos legales"
                                onclick="toggleAmenity(this)">
                            <span>ğŸ’° Impuestos / Pagos legales</span>
                        </label>
                        <label class="option">
                            <input type="checkbox" name="ayudas" value="Materiales / Cosas generales"
                                onclick="toggleAmenity(this)">
                            <span>ğŸ“¦ Materiales / Cosas generales</span>
                        </label>
                    </div>


                    <div class="form-wrap">
                        <!-- Contenedor para la vista previa de la imagen -->
                        <div class="input-group">
                            <label class="form-label">Una captura de la hoja de factura, por favor.</label>
                            <img id="imagePreview" alt="Vista previa de la imagen">
                        </div>

                        <div class="input-group">
                            <div class="container2">
                                <div class="folder">
                                    <div class="front-side">
                                        <div class="tip"></div>
                                        <div class="cover"></div>
                                    </div>
                                    <div class="back-side cover"></div>
                                </div>
                                <label class="custom-file-upload">
                                    <input required id="adjuntar" name="adjuntar" class="title" type="file"
                                        accept="image/*" onchange="previewImage()" />
                                    Choose a file
                                </label>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="submitButton" onclick="UploadFile()" disabled>Enviar</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Loader -->
    <div class="cssload-main">
        <div class="cssload-heart">
            <span class="cssload-heartL"></span>
            <span class="cssload-heartR"></span>
            <span class="cssload-square"></span>
        </div>
        <div class="cssload-shadow"></div>
    </div>


    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <img id="facu" alt="">
            <div class="live">
                <img id="Correct" src="img/4067335.jpg" alt="">

            </div>
            <span class="close" onclick="closeModal('')">&times;</span>
            <div id="modalMessage"></div>
        </div>
    </div>


    <script>
        //  Verifica si todos los campos requeridos estÃ¡n completos
        function checkFormCompletion() {
            const requiredFields = document.querySelectorAll("input[required]");
            const fileInput = document.getElementById("adjuntar");

            const allFilled = [...requiredFields].every(field => {
                if (field.type === "checkbox") {
                    const group = document.querySelectorAll(`input[name="${field.name}"]:checked`);
                    return group.length > 0; //  Al menos una ayuda seleccionada
                }
                return field.value.trim();
            }) && fileInput.files.length > 0;

            document.getElementById("submitButton").disabled = !allFilled;
        }

        //  Aplica la validaciÃ³n en todos los campos requeridos
        document.querySelectorAll("input[required]").forEach(input => {
            input.addEventListener("input", checkFormCompletion);
            if (input.type === "checkbox") {
                input.addEventListener("change", checkFormCompletion);
            }
        });
        window.onload = checkFormCompletion;

        //  Vista previa de imagen seleccionada
        function previewImage() {
            const fileInput = document.getElementById("adjuntar");
            const preview = document.getElementById("imagePreview");

            if (fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = "block";
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                preview.style.display = "none";
            }

            checkFormCompletion();
        }

        //  Controla la selecciÃ³n mÃ¡xima de ayudas (checkboxes)
        function toggleAmenity(checkbox) {
            const selected = document.querySelectorAll('input[name="ayudas"]:checked');
            if (selected.length > 5) {
                checkbox.checked = false;
                Swal.fire("Â¡MÃ¡ximo 5 ayudas!", "Por favor selecciona hasta cinco opciones.", "warning");
                return;
            }

            const label = checkbox.closest('.option');
            if (checkbox.checked) {
                label.classList.add("selected");
            } else {
                label.classList.remove("selected");
            }

            checkFormCompletion();
        }

        //  Obtiene las ayudas seleccionadas como texto
        function obtenerAyudasSeleccionadas() {
            return Array.from(document.querySelectorAll('input[name="ayudas"]:checked')).map(cb => cb.value);
        }

        //  EnvÃ­o del formulario con archivo y datos
        function UploadFile() {
            const reader = new FileReader();
            const file = document.getElementById("adjuntar").files[0];
            showLoader();

            reader.onload = function () {
                // Carga contenido del archivo
                document.getElementById("fileContent").value = reader.result;
                document.getElementById("filename").value = file.name;

                // Captura el formulario
                const form = document.getElementById("uploadForm");
                const formData = new FormData(form);

                // Agrega las ayudas seleccionadas
                const ayudas = obtenerAyudasSeleccionadas();
                formData.set("ayudas", ayudas.join(", "));

                // Agrega fecha y hora actual
                const now = new Date();
                const fecha = now.toLocaleDateString("es-CO"); // ej. 23/04/2025
                const hora = now.toLocaleTimeString("es-CO");  // ej. 10:15:32 a.Â m.

                formData.set("fechaEnvio", fecha);
                formData.set("horaEnvio", hora);

                // EnvÃ­a los datos
                fetch(form.action, {
                    method: "POST",
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        hideLoader();
                        if (data.status === "success") {
                            document.getElementById("modalMessage").innerHTML = `
            <h2>${data.message}</h2>
            <p><strong>Nombre:</strong> ${data.details.nombre}</p>
            <p><strong>Nequi:</strong> ${data.details.nequi}</p>
            <p><strong>Ayudas:</strong> ${data.details.ayudas}</p>
            <p><strong>Archivo:</strong> <a href="${data.details.fileUrl}" target="_blank">Ver archivo</a></p>
            <p><strong>Fecha:</strong> ${fecha}</p>
            <p><strong>Hora:</strong> ${hora}</p>
          `;
                            document.getElementById("myModal").style.display = "block";
                        } else {
                            Swal.fire("Error", data.message, "error");
                        }
                    })
                    .catch(error => {
                        hideLoader();
                        Swal.fire("Error", "Error al enviar datos", "error");
                        console.error(error);
                    });
            };

            reader.readAsDataURL(file);
        }


        // Muestra el loader
        function showLoader() {
            document.querySelector(".cssload-main").style.display = "flex";
        }

        //  Oculta el loader
        function hideLoader() {
            document.querySelector(".cssload-main").style.display = "none";
        }

        //  Cierra el modal y resetea el formulario
        function closeModal() {
            document.getElementById("myModal").style.display = "none";
            document.getElementById("uploadForm").reset();
            document.getElementById("imagePreview").style.display = "none";
            document.getElementById("submitButton").disabled = true;
            document.querySelectorAll('.option.selected').forEach(option => {
                option.classList.remove('selected');
            });
        }
    </script>



</body>

</html>